apiVersion: v1alpha1
kind: Setting
metadata:
  name: plugin-encrypt-settings
spec:
  forms:
    - group: basic
      label: 基础设置
      formSchema:
        - $formkit: checkbox
          label: 启用加密功能
          name: enable
          id: enable
          key: enable
          value: true
          help: "关闭后将不处理加密标记"
        
        - $formkit: text
          label: 解锁框标题
          name: lockTitle
          id: lockTitle
          key: lockTitle
          value: "内容已加密"
          help: "加密内容占位框显示的标题"
        
        - $formkit: text
          label: 密码输入提示
          name: passwordPlaceholder
          id: passwordPlaceholder
          key: passwordPlaceholder
          value: "请输入密码解锁"
          help: "密码输入框的提示文字"
        
        - $formkit: text
          label: 解锁按钮文字
          name: unlockButtonText
          id: unlockButtonText
          key: unlockButtonText
          value: "解锁"
          help: "解锁按钮显示的文字"
        
        - $formkit: textarea
          label: 加密提示说明
          name: lockDescription
          id: lockDescription
          key: lockDescription
          value: "此内容已加密保护，请输入密码后查看"
          help: "加密内容框中显示的描述文字"

    - group: style
      label: 样式设置
      formSchema:
        - $formkit: select
          name: theme
          id: theme
          key: theme
          label: 主题风格
          value: "default"
          options:
            - label: 默认主题
              value: default
            - label: 暗色主题
              value: dark
            - label: 简约主题
              value: minimal
            - label: 渐变主题
              value: gradient
          help: "选择加密框的显示主题"
        
        - $formkit: color
          label: 主色调
          name: primaryColor
          id: primaryColor
          key: primaryColor
          value: "#4F8DFD"
          help: "解锁按钮和边框的主色调"
        
        - $formkit: color
          label: 背景色
          name: backgroundColor
          id: backgroundColor
          key: backgroundColor
          value: "#f8fafc"
          help: "加密框的背景颜色"
        
        - $formkit: color
          label: 文字颜色
          name: textColor
          id: textColor
          key: textColor
          value: "#334155"
          help: "加密框中的文字颜色"
        
        - $formkit: text
          label: 边框圆角
          name: borderRadius
          id: borderRadius
          key: borderRadius
          value: "12px"
          help: "加密框的边框圆角"

    - group: security
      label: 安全设置
      formSchema:
        - $formkit: number
          label: 密码错误锁定次数
          name: maxFailAttempts
          id: maxFailAttempts
          key: maxFailAttempts
          value: 5
          min: 1
          max: 20
          help: "连续输入错误密码超过此次数后临时锁定"
        
        - $formkit: number
          label: 锁定时间（分钟）
          name: lockDuration
          id: lockDuration
          key: lockDuration
          value: 15
          min: 1
          max: 60
          help: "密码错误锁定的持续时间"
        
        - $formkit: checkbox
          label: 记录解锁日志
          name: enableUnlockLog
          id: enableUnlockLog
          key: enableUnlockLog
          value: true
          help: "记录所有解锁操作日志"

    - group: totp
      label: 动态密码
      formSchema:
        - $formkit: checkbox
          name: enableTotp
          id: enableTotp
          key: enableTotp
          label: 启用动态密码
          value: false
          help: "启用后可使用时效性动态密码解锁加密内容"
        
        - $formkit: select
          name: validityPeriod
          id: validityPeriod
          key: validityPeriod
          label: 密码有效期
          value: DAY_1
          options:
            - label: 30秒 (最安全)
              value: SECONDS_30
            - label: 1小时
              value: HOUR_1
            - label: 1天 (推荐)
              value: DAY_1
            - label: 1周
              value: WEEK_1
            - label: 1月
              value: MONTH_1
          help: "密码更换频率，推荐使用每日更换"
        
        - $formkit: text
          name: totpSecret
          id: totpSecret
          key: totpSecret
          label: TOTP 密钥
          value: ""
          help: "留空后点击保存，然后在浏览器控制台执行: fetch('/apis/encrypt.halo.run/v1alpha1/totp/generate',{method:'POST'}).then(r=>r.json()).then(d=>{prompt('密钥已生成，请复制:',d.secret)})"
        
        - $formkit: password
          name: masterKey
          id: masterKey
          key: masterKey
          label: 万能密钥
          value: ""
          help: "备用固定密码，永不过期，用于核心用户或忘记动态密码时使用"
        
        - $formkit: text
          name: totpApiUrl
          id: totpApiUrl
          key: totpApiUrl
          label: 获取当前密码
          value: "/apis/encrypt.halo.run/v1alpha1/totp/current"
          disabled: true
          help: "在浏览器新标签页访问此地址可查看当前动态密码"

    - group: categoryEncrypt
      label: 分类加密
      formSchema:
        - $formkit: group
          name: categoryEncryptSettings
          label: ""
          children:
            - $formkit: repeater
              name: categoryList
              id: categoryList
              key: categoryList
              label: 加密分类列表
              addLabel: "+ 添加分类加密"
              min: 0
              value: []
              help: "为指定分类设置统一的加密密码，该分类下所有文章将自动加密"
              children:
                - $formkit: group
                  name: item
                  children:
                    - $formkit: text
                      name: categoryName
                      label: 分类标识（slug）
                      placeholder: "例如: vip"
                      validation: "required"
                      help: "填写分类的 slug（在分类设置中可看到）"
                    - $formkit: password
                      name: password
                      label: 加密密码
                      placeholder: "请输入密码"
                      validation: "required|length:4"
                      help: "至少4位"
                    - $formkit: text
                      name: hint
                      label: 提示文字（可选）
                      placeholder: "例如: VIP专享内容"
                    - $formkit: checkbox
                      name: enabled
                      label: 启用
                      value: true

    - group: paid
      label: 付费设置（开发中）
      formSchema:
        - $formkit: checkbox
          label: 启用付费解锁
          name: enablePaid
          id: enablePaid
          key: enablePaid
          value: false
          help: "启用付费解锁功能（需配置支付接口）"
        
        - $formkit: select
          name: paymentProvider
          id: paymentProvider
          key: paymentProvider
          label: 支付渠道
          value: ""
          options:
            - label: 请选择
              value: ""
            - label: 微信支付
              value: wechat
            - label: 支付宝
              value: alipay
            - label: Stripe
              value: stripe
          help: "选择付费解锁使用的支付渠道"
        
        - $formkit: password
          label: 支付API密钥
          name: paymentApiKey
          id: paymentApiKey
          key: paymentApiKey
          value: ""
          help: "支付渠道的API密钥"
        
        - $formkit: text
          label: 回调地址
          name: paymentCallbackUrl
          id: paymentCallbackUrl
          key: paymentCallbackUrl
          value: ""
          help: "支付成功后的回调通知地址"

