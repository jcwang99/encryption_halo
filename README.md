# Halo 文章加密插件

> 🔐 支持区块加密、全文加密、分类加密，TOTP 动态密码，加密过期自动公开，摘要保护

## ✨ 功能特性

### 🔒 多种加密方式

| 方式 | 说明 |
|-----|------|
| **区块加密** | 加密文章部分内容 |
| **全文加密** | 一键加密整篇文章 |
| **分类加密** | 按分类批量设置密码 |

### 🔑 灵活的认证方式

| 方式 | 说明 |
|-----|------|
| **固定密码** | 传统密码保护 |
| **TOTP 动态密码** | 支持多密码管理，可配置有效期（30秒/1小时/1天/1周/1月） |
| **万能密钥** | 管理员备用密码 |

### ⏰ 加密过期

设置加密期限，到期后内容自动变为公开：
- 7天后公开
- 30天后公开
- 自定义日期

### 🛡️ 摘要保护 (v1.3.0 新增)

**自动保护加密文章摘要**，防止在首页/列表页泄露加密内容：

| 加密类型 | 摘要显示 |
|---------|---------|
| 部分加密 | `🔒 部分内容已加密` |
| 分类加密 | `🔒 此分类内容需要密码查看` |
| 全文加密 | `🔒 此内容需要密码才能查看` |

- ✅ 服务端保护，文章发布时自动处理
- ✅ 原始摘要备份，支持恢复
- ✅ 无需手动操作

### 🎨 UI 特性

- ✅ 解锁动画（浮动图标/发光效果）
- ✅ 深色模式支持
- ✅ 毛玻璃效果
- ✅ 移动端适配

### � 安全功能

- ✅ 密码错误锁定（可配置次数和时间）
- ✅ BCrypt 密码加密
- ✅ XSS 防护
- ✅ 会话记忆（刷新保持解锁）

---

## 📥 安装

### 源码编译

```bash
git clone https://github.com/jcwang99/encryption_halo.git
cd encryption_halo
./gradlew build
```

编译完成后，在 `build/libs/` 目录下找到 jar 文件，上传到 Halo 后台 → 插件。

---

## 🚀 使用方法

### 区块加密

在编辑器中使用工具栏按钮：

```
[encrypt password="your_password"]
这里是加密内容...
[/encrypt]
```

### 全文加密

点击编辑器工具栏的「加密」按钮 → 选择「全文加密」

或在内容中添加：
```html
<!--encrypt:full password="密码" hint="提示信息"-->
需要加密的内容...
```

### 加密过期

```
[encrypt password="vip" expires="2025-12-31"]
限时 VIP 内容，2025年12月31日后自动公开
[/encrypt]
```

### 分类加密

1. 进入插件设置 → 分类加密
2. 添加分类加密规则
3. 选择分类、设置密码和提示信息
4. 该分类下所有文章自动加密

---

## 🔑 TOTP 动态密码管理 (v1.3.0 增强)

支持创建**多个动态密码**，每个密码可以设置不同的有效期：

### 使用步骤

1. 进入 **工具 → 动态密码管理**（或访问 `/console/tools/totp`）
2. 点击「新建密码」
3. 设置名称和有效期：
   - 30秒（标准 TOTP）
   - 1小时
   - 1天
   - 1周
   - 1个月
4. 系统自动生成密钥并显示当前密码
5. 复制密码分享给用户

### 密码特性

| 特性 | 说明 |
|-----|------|
| **多密码支持** | 可创建多个独立密码 |
| **独立有效期** | 每个密码可设不同周期 |
| **实时倒计时** | 显示密码剩余有效时间 |
| **一键复制** | 快速复制当前密码 |
| **随时禁用** | 可单独启用/禁用密码 |

### 验证优先级

用户输入密码时，按以下顺序验证：

```
TOTP 动态密码 → 万能密钥 → 区块固定密码
```

---

## ⚙️ 配置说明

### 基础设置
- 解锁框标题
- 密码输入提示
- 加密提示说明

### 安全设置
- 密码错误锁定次数
- 锁定时间
- 解锁日志

### 动态密码
- 启用 TOTP
- 万能密钥

### 分类加密
- 选择分类
- 设置密码
- 提示信息

---

## 📝 更新日志

### v1.4.1
- ✨ **全文加密 TOTP**：支持为整篇加密文章生成独立的动态密码
- 🐛 **修复属性解析**：修复正则表达式不支持连字符导致 `totp-id` 无法解析的问题

### v1.4.0
- ✨ **区块级动态密码**：支持为单个加密区块生成独立的 TOTP 密码
- ✨ **智能标签显示**：自动显示文章标题和区块序号（如："技术文档 - 区块1"）
- ✨ **批量管理**：在后台统一查看、复制和删除所有区块密码
- 🎨 **UI优化**：添加未保存文章提示，优化显示效果

### v1.3.0
- ✨ **多 TOTP 密码管理**：支持创建多个动态密码，各自独立有效期
- ✨ **统一摘要保护**：服务端自动保护加密文章摘要，防止内容泄露
- ✨ **摘要备份恢复**：原始摘要自动备份到 annotation

### v1.2.0
- ✨ 加密过期功能
- ✨ 全文加密注释格式支持

### v1.1.0
- ✨ TOTP 动态密码
- ✨ 分类加密

### v1.0.0
- 🎉 初始版本
- ✨ 区块加密
- ✨ 全文加密

---

## 📄 许可证

GPL-3.0

---

## 🙏 鸣谢

基于 [halo-plugin-summaraidGPT](https://github.com/acanyo/halo-plugin-summaraidGPT) 开发
